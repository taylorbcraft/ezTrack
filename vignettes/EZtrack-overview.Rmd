---
title: "ezTrack Overview"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ezTrack Overview}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(ezTrack)
```

## Introduction

This vignette demonstrates a full workflow using ezTrack. It imports tracking data with non-standard column names, cleans and standardizes it, computes a summary table of the tracking data, and displays the results on an interactive map.

## 1. Simulate Tracking Data with Irregular Format

We simulate a small tracking dataset with non-standard column names. `ez_track()` will automatically guess which columns correspond to ID, timestamp, longitude, and latitude.

```{r}
set.seed(123)

n_individuals <- 4
n_points <- 20

sample_data <- data.frame(
  animal = rep(paste0("Animal_", LETTERS[1:n_individuals]), each = n_points),
  date = rep(seq.POSIXt(
    from = as.POSIXct("2023-01-01 08:00"),
    by = "6 hours",
    length.out = n_points), n_individuals),
  location_long = runif(n_individuals * n_points, 5.5, 7),
  location_lat = runif(n_individuals * n_points, 52, 53.5)
)

head(sample_data)

```

## 2. Import and Clean the Data

We pass the dataset to ez_track() without specifying any column names. It automatically detects the appropriate columns using heuristics.

```{r}
tracks <- ez_track(
  path = sample_data,
  as_sf = TRUE
)

head(tracks)

```


## 3. Manually Specifying Column Names

If automatic column guessing fails or guesses incorrectly, you can manually specify which columns represent the ID, timestamp, longitude, and latitude.

Here is an example where the column names are ambiguous and require manual input.

```{r}
# Create intentionally confusing column names
messy_data <- data.frame(
  uid = rep(c("X1", "X2"), each = 4),
  date_obs = rep(seq.POSIXt(as.POSIXct("2023-03-01 06:00"), by = "3 hours", length.out = 4), 2),
  lon_deg = runif(8, -100, -90),
  lat_deg = runif(8, 40, 45)
)

head(messy_data)
```
If we try to use ez_track() without specifying columns, it may not work as expected.
Instead, we provide the correct column names manually:
  
```{r}
manual_cleaned <- ez_track(
  path = messy_data,
  id_col = "uid",
  time_col = "date_obs",
  x_col = "lon_deg",
  y_col = "lat_deg"
)

head(manual_cleaned)
```
## 4. Summarize the Tracking Data

We compute summary statistics for each individual using `ez_summary()`.

```{r}
summary_table <- ez_summary(tracks)
summary_table
```

## 5. Visualize the Tracks on an Interactive Map

We display the movement tracks using an interactive Leaflet map with `ez_map()`.

```{r}
ez_map(tracks)
ez_map(tracks, plotPath = TRUE,
  plotPoints = TRUE,
  pointRadius = 2,
  pointColor = "id",
  pointOpacity = 1,
  pointStroke = TRUE,
  pointStrokeColor = "black",
  pathColor = "id",
  pathWidth = 2,
  pathOpacity = 0.5,
  showLabels = TRUE)

```

